---

copyright:
  years: 2015, 2018
lastupdated: "2018-06-09"

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:tip: .tip}
{:pre: .pre}
{:codeblock: .codeblock}
{:screen: .screen}
{:javascript: .ph data-hd-programlang='javascript'}
{:java: .ph data-hd-programlang='java'}
{:python: .ph data-hd-programlang='python'}
{:swift: .ph data-hd-programlang='swift'}

# Authenticating with IAM tokens
{: #iam}

You use {{site.data.keyword.cloud}} Identity and Access Management (IAM) tokens to make authenticated requests to {{site.data.keyword.ibmwatson}} services without embedding service credentials in every call.
{: shortdesc}

{{site.data.keyword.cloud}} is in the process of migrating to token-based Identity and Access Management (IAM) authentication. IAM authentication uses access tokens for authentication, which you acquire by a request with an API key. {{site.data.keyword.ibmwatson}} has implemented IAM for use with services that are created with the Resource Controller (RC) or are migrated from Cloud Foundry to a resource group in the RC.

**Note:** If you have migrated a service to Resource Controller, continue to use your existing authentication mechanism until you create and begin to use a new set of credentials.

To access API methods by using IAM, you must first collect the credentials from the service dashboard. See [Getting credentials manually](/docs/services/watson/getting-started-credentials.html#getting-credentials-manually).

![Example {{site.data.keyword.watson}} service credentials.](images/IAM-apikey.png)

## How to get an IAM token by using a Watson service API key
{: #iamtoken}

You can access {{site.data.keyword.ibmwatson}} service APIs by using the API keys that were generated in the service instance credentials. The API key is used to generate an IAM access token. You also use this process if you are developing an application that needs to work with other {{site.data.keyword.cloud_notm}} services.

For detailed information and tips about securely using API keys, see [Watson service API keys](/docs/services/watson/apikey-bp.html).
{: tip}

1. The following cURL command uses the `POST identity/token` method to generate an IAM token by passing an API key.

**Headers:**
  - `Content-Type: application/x-www-form-urlencoded`
  - `Accept: application/json`

**With parameters:**
  - `grant_type=urn:ibm:params:oauth:grant-type:apikey`
  - `apikey={api_key}`

```bash
curl -k -X POST \
  --header "Content-Type: application/x-www-form-urlencoded" \
  --header "Accept: application/json" \
  --data-urlencode "grant_type=urn:ibm:params:oauth:grant-type:apikey" \
  --data-urlencode "apikey={api_key}" \
  "https://iam.bluemix.net/identity/token"
```
{: pre}

It is recommended that you use authentication to generate the access token. The same authentication is required if the token needs to be refreshed:

```bash
curl -k -X POST \
  --header "Authorization: Basic Yng6Yng=" \
  --header "Content-Type: application/x-www-form-urlencoded" \
  --header "Accept: application/json" \
  --data-urlencode "grant_type=urn:ibm:params:oauth:grant-type:apikey" \
  --data-urlencode "apikey={api_key}" \
  "https://iam.bluemix.net/identity/token"

```
{: pre}

The following sample shows the expected response:

```javascript
{
  "access_token": "eyJhbGciOiJIUz......sgrKIi8hdFs",
  "refresh_token": "SPrXw5tBE3......KBQ+luWQVY",
  "token_type": "Bearer",
  "expires_in": 3600,
  "expiration": 1473188353
}
```
{: pre}

## Using a token to authenticate
{: #use_token}

An IAM access token that is generated by using the `identity/token` method can then be used to make authenticated API calls. A token can be used only for calls to the service instance that is associated with the API key that was used to generate the token.

A typical cURL call to a {{site.data.keyword.watson}} service takes the following form:

```bash
curl -X GET \
--header "Authorization: Bearer {token}" \
"https://gateway.watsonplatform.net/discovery/api/v1/environments?version=2017-11-07"
```
{: pre}

Where `{token}` is the IAM access token that you generated.

Alternatively, you could save the token to a file, prefixing it with `Authorization: Bearer ` (for example `Authorization: Bearer eyJhbGciOiJIUz......sgrKIi8hdFs`) and then use the following command:

```bash
curl -X GET \
--header "$(cat token.txt)" \
"https://gateway.watsonplatform.net/discovery/api/v1/environments?version=2017-11-07"
```
{: pre}

## Refreshing a token
{: #refresh_token}

The refresh token can be used to extend the life of the access token. The following command refreshes an existing access token:

```bash
curl -k -X POST \
  --header "Authorization: Basic Yng6Yng=" \
  --data-urlencode "grant_type=refresh_token" \
  --data-urlencode "refresh_token={refresh-token}" \
  "https://iam.bluemix.net/identity/token"
```
{: pre}

Where `{refresh-token}` is the IAM refresh token that you generated.

**Important:** When you refresh a token, use the same authentication that you used to create the original token.
